{% extends 'base.html' %} {% block title %}
  Members
{% endblock %} 
{% block content %}
<div class="min-h-screen bg-gray-900 text-white space-y-1">
   <div class="w-full bg-gray-800 border-b border-gray-700 px-6 py-4 flex items-center justify-between">
    <div class="flex gap-2 flex-row">
      <button
        onclick="window.history.back()"
        class="px-6 py-2 bg-white text-black font-semibold flex items-center justify-center border-2 border-green-500 hover:border-blue-700 rounded-lg transition"
      >
        â† Back
      </button>

      <button
        onclick="window.location.href='{% url 'orghome' %}'"
        class="px-6 py-2 bg-white text-black font-semibold flex items-center justify-center border-2 border-green-500 hover:border-blue-700 rounded-lg transition"
      >
        Home
      </button>
    </div>

    <div class="flex flex-row gap-10">
      <a
        href="{% url 'member_add' %}"
        class="px-6 bg-white text-black flex items-center justify-center border-2 border-green-500 hover:border-blue-700 rounded-lg font-semibold transition"
      >
        â• Add Member
      </a>

      <!-- Profile Dropdown -->
      <div class="relative rounded-full bg-white">
        <button
          id="profileBtn"
          class="px-6 rounded-full overflow-hidden flex items-center justify-center border-2 border-green-500 hover:border-blue-700"
        >
          {% if request.session.org_photo %}
          <!-- Uploaded org photo -->
          <img
            src="{{ request.session.org_photo }}"
            alt="Profile"
            class="w-5 h-12 px-0 object-contain"
          />
          {% else %}
          <!-- Auto-generated initials -->
          <img
            src="https://ui-avatars.com/api/?name={{ request.session.orgname }}&background=22c55e&color=fff&bold=true"
            alt="Profile"
            class="w-full h-full object-cover"
          />
          {% endif %}
        </button>

        <!-- Dropdown Menu -->
        <div
          id="profileMenu"
          class="hidden absolute right-0 mt-3 w-48 bg-gray-900 border border-gray-700 rounded-xl shadow-lg overflow-hidden z-50"
        >
          <a
            href=""
            class="block px-4 py-3 text-sm text-white hover:bg-gray-700"
          >
            ğŸ‘¤ Profile
          </a>

          <a
            href=""
            class="block px-4 py-3 text-sm text-white hover:bg-gray-700"
          >
            âš™ï¸ Account Settings
          </a>

          <form method="post" action="{% url 'org_logout' %}">
            {% csrf_token %}
            <button
              type="submit"
              class="w-full text-left px-4 py-3 text-sm text-red-400 hover:bg-gray-700"
            >
              ğŸšª Logout
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

    <!-- Members Table -->
    <div class="px-8">
      <div class="h-full text-black bg-white rounded">
        <table class="w-full text-left">
          <thead class="bg-gray-700 text-white rounded-lg">
            <tr>
              <th class="p-4">Name</th>
              <th class="p-4">Email</th>
              <th class="p-4">Membership</th>
              <th class="p-4">Phone Number</th>
              <th class="p-4">Status</th>
              <th class="p-4">Actions</th>
            </tr>
          </thead>

          <tbody>
            {% for member in members %}
              <tr class=" border-b outline-2 rounded-lg outline-green-600 hover:outline-blue-600 transition">
                <td class="p-4 font-semibold">{{ member.first_name|upper }} {{ member.last_name|upper }}</td>
                <td class="p-4">{{ member.email }}</td>
                <td class="p-4">{{ member.membership_type|upper }}</td>
                <td class="p-4">{{ member.phone }}</td>

                <td class="p-4">
                  {% if member.status == 'active' %}
                    <span class="px-3 py-1 text-sm bg-green-500 rounded-full">Active</span>
                  {% elif member.status == "inactive" %}
                    <span class="px-3 py-1 text-sm bg-red-500 rounded-full">Inactive</span>
                  {% endif %}
                </td>

                <td class="p-4 relative">
                  <!-- Action Button -->
                  <button onclick="toggleDropdown('{{ member.id }}')" class="px-3 py-1 text-black outline-1 outline-green-400 hover:outline-blue-500 hover:bg-white hover:text-black rounded-lg text-sm transition">Actions â–¾</button>


                  <!-- Dropdown -->
                  <div id="dropdown-{{ member.id }}" class="hidden absolute right-0 mt-2 w-40 bg-gray-900 border border-gray-700 rounded-xl shadow-lg z-50">


                    <!-- View -->
                    <a href="" class="block px-4 py-2 text-sm text-white hover:bg-gray-700">ğŸ‘ View</a>


                    <!-- Update -->
                    <a href="" class="block px-4 py-2 text-sm text-blue-400 hover:bg-gray-700">âœï¸ Update</a>


                    <!-- Delete -->
                    <form method="post" action="{% url 'member_delete' member.id %}">
                      {% csrf_token %}

                      <input type="hidden" name="delete_payments" value="no" id="delete-payments-{{ member.id }}">

                      <button type="submit" onclick="return confirmDelete( '{{ member.id }}' , {{ member.has_payment|yesno:"true,false" }}) "
                        class="w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700">
                          ğŸ—‘ Delete
                      </button>
                    </form>


                  </div>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="6" class="p-6 text-center text-gray-400">No members found</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>


  <script>
    


    function confirmDelete(memberId, has_payment) {

      const hiddenInput = document.getElementById(`delete-payments-${memberId}`);

      if(has_payment){
        const delete_payments = confirm(
            "This member has payment history.\n\n" +
            "OK â†’ Delete member + payment history\n" +
            "Cancel â†’ Delete member only"
        );

        hiddenInput.value = delete_payments ? "yes" : "no";
      }

      else{
        const confirmMemberDelete = confirm(
          "Do you want to Delete this Member ??"
        );

        if(!confirmMemberDelete){
          return false;
        }

        hiddenInput.value = "no"
      }

      return confirm("Are you sure you want to proceed ??")

    }




  function toggleDropdown(id) {
    event.stopPropagation();
    document.querySelectorAll('[id^="dropdown-"]').forEach((el) => {
      if (el.id !== `dropdown-${id}`) el.classList.add("hidden");
    });
    document.getElementById(`dropdown-${id}`).classList.toggle("hidden");
  }

  const profileBtn = document.getElementById("profileBtn");
  const profileMenu = document.getElementById("profileMenu");

  profileBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    profileMenu.classList.toggle("hidden");
  });

  profileMenu.addEventListener("click", (e) => {
    e.stopPropagation();
  });

  document.addEventListener("click", function () {
    profileMenu.classList.add("hidden");

    document.querySelectorAll('[id^="dropdown-"]').forEach((el) => {
      el.classList.add("hidden");
    });
  });
  </script>
{% endblock %}
